<app-header></app-header>

<div class="review-container">
  <!-- Left column: Congratulations and actions -->
  <div class="congratulations-column">
    <h1 class="heading">Congratulations on creating your Will!</h1>
    
    <p class="description">
      For your will to be valid or legal, you are required to sign in the presence of two or more witnesses.
    </p>
    
    <div class="actions">
      <button mat-flat-button class="sign-button" (click)="signAndValidate()">
        Sign and Validate your will
      </button>
      
      <a class="download-link" (click)="downloadWatermarked()">
        Download watermarked version of your will
      </a>
    </div>
  </div>
  
  <!-- Right column: PDF preview -->
  <div class="pdf-preview-column">
    <div class="pdf-header">
      <span class="edit-prompt">Would you like to make some changes?</span>
      <button mat-icon-button class="edit-button" (click)="editWill()">
        <mat-icon>edit</mat-icon>
      </button>
    </div>
    
    <div class="pdf-container">
      <!-- Loading spinner -->
      <div class="loading-container" *ngIf="isLoading">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading your will...</p>
      </div>
      
      <!-- PDF Viewer - Only render in browser environment -->
      <ng-container *ngIf="isBrowser && pdfSrc && !pdfError && !isLoading">
        <pdf-viewer
          [src]="pdfSrc"
          [render-text]="true"
          [original-size]="false"
          [show-all]="true"
          [page]="currentPage"
          [zoom]="zoom"
          (after-load-complete)="onPdfLoaded($event)"
          (error)="onPdfError($event)"
          style="display: block; height: 100%;"
        ></pdf-viewer>
      </ng-container>
      
      <!-- Fallback content for SSR or errors -->
      <div class="sample-will" *ngIf="(!isBrowser || pdfError || !pdfSrc) && !isLoading">
        <div class="sample-will-content">
          <h2 class="sample-will-title">LAST WILL AND TESTAMENT OF</h2>
          <h3 class="sample-will-name">Jane Doe</h3>
          
          <p class="sample-will-text">
            I, [Full Name], of [Address], being of sound mind and lawful age, declare this document to be my Last Will and Testament. I revoke all previous wills and codicils made by me and confirm that this document reflects my final wishes for the distribution of my estate.
          </p>
          
          <h4 class="sample-will-section">1. DECLARATION AS TO SANITY AND AGAINST</h4>
          <p class="sample-will-text">
            I hereby declare that I make and execute this Will in a perfect state of mental health and I am not under any undue influence whatsoever in making this disposition.
          </p>
          
          <h4 class="sample-will-section">DECLARATION AS TO NAME</h4>
          <p class="sample-will-text">
            I hereby declare that during my lifetime, I answer to the following names: <strong>Jane Doe</strong>. Any document including conveyances and any other document of title to real and personal properties bearing the aforesaid names thereby refer to me.
          </p>
          
          <h4 class="sample-will-section">I DECLARE THAT WHEREVER THE WORD "WIFE" </h4>
          <p class="sample-will-text">
            shall appear in this Will, it shall be taken that I am referring only to:
          </p>
          <ul class="sample-will-list">
            <li>Mary Jane (Wife)</li>
          </ul>
          
          <h4 class="sample-will-section">I DECLARE THAT WHEREVER THE WORD "CHILD" OR "CHILDREN"</h4>
          <p class="sample-will-text">
            shall appear in this Will, it shall be taken that I am referring only to the following or one of them as the case may be, to wit:
          </p>
        </div>
      </div>
    </div>
    
    <!-- PDF navigation controls -->
    <div class="pdf-navigation" *ngIf="!isLoading">
      <button mat-icon-button [disabled]="currentPage <= 1" (click)="previousPage()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <span class="page-indicator">Page {{ currentPage }} of {{ totalPages || 5 }}.</span>
      <button mat-icon-button [disabled]="currentPage >= (totalPages || 5)" (click)="nextPage()">
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>
</div>
