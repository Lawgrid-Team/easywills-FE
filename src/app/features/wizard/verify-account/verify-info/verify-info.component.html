<div class="max-w-4xl mx-auto px-8 md:px-12 py-12">
    <!-- Heading -->
    <h2 class="text-4xl font-bold text-easywills-black font-DM_Serif mb-4">
        Provide the necessary documents
    </h2>
    <p class="text-easywills-dark-grey mb-6">
        Securely upload any necessary documents to ensure your will is
        comprehensive and accurate.
    </p>

    <!-- QoreID Button -->
    <qoreid-button hideButton="yes" id="QoreIDButton" [attr.clientId]="qoreIdConfig.clientId"
        [attr.flowId]="qoreIdConfig.flowId" [attr.customerReference]="qoreIdConfig.customerReference"
        [attr.applicantData]="applicantDataJson" [attr.identityData]="identityDataJson"
        onQoreIDSdkSubmitted="window.onQoreIDSdkSubmitted" onQoreIDSdkError="window.onQoreIDSdkError"
        onQoreIDSdkClosed="window.onQoreIDSdkClosed">
    </qoreid-button>

    <!-- Document Type Selection -->
    <div class="flex gap-4">
        <button *ngFor="let doc of idTypes" (mouseenter)="hoveredDocumentType = doc.name"
            (mouseleave)="hoveredDocumentType = null" [ngClass]="{
                'border-2 border-primary bg-white': selectedDocumentType === doc.name,
                'border border-gray-300 bg-gray-50': selectedDocumentType !== doc.name,
                'opacity-50 cursor-not-allowed': isVerifying
            }" (click)="selectDocument(doc.name)" [attr.disabled]="isVerifying ? true : null"
            class="relative px-4 py-6 rounded-md flex-1 text-center shadow-sm transition">

            <div *ngIf="hoveredDocumentType === doc.name && selectedDocumentType !== doc.name"
                class="absolute top-2 right-2 w-6 h-6 border-2 border-gray-400 rounded-full">
            </div>

            <div *ngIf="selectedDocumentType === doc.name"
                class="absolute top-2 right-2 bg-black rounded-full p-1 flex items-center justify-center z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="white"
                    class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
            </div>

            <div class="flex justify-center mb-2">
                <ng-container [ngSwitch]="doc.icon">
                    <img *ngSwitchCase="'id-card'" src="svg/verify-identity/national-id.svg" alt="National ID"
                        class="w-8 h-8" />
                    <img *ngSwitchCase="'passport'" src="svg/verify-identity/passport.svg" alt="Passport"
                        class="w-8 h-8" />
                    <img *ngSwitchCase="'license'" src="svg/verify-identity/drivers-license.svg" alt="Driver License"
                        class="w-8 h-8" />
                </ng-container>
            </div>

            <div class="text-gray-700 font-normal">{{ doc.name }}</div>
        </button>
    </div>

    <!-- Form -->
    <form *ngIf="selectedDocumentType" [formGroup]="form" class="mt-6 space-y-4">
        <label>What is the identification number?</label>
        <mat-form-field appearance="outline" class="w-full">
            <input matInput formControlName="idNumber" [placeholder]="getPlaceholderForSelectedType()"
                [maxlength]="getMaxLengthForSelectedType()" (input)="onIdNumberInput($event)" />
            <mat-error *ngIf="form.get('idNumber')?.invalid && form.get('idNumber')?.touched">
                {{ getErrorMessageForSelectedType() }}
            </mat-error>
        </mat-form-field>

        <label>What is the expiry date?</label>
        <mat-form-field appearance="outline" class="w-full">
            <input matInput [matDatepicker]="picker" [min]="today" formControlName="expiryDate"
                placeholder="DD/MM/YYYY" />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <!-- Status Messages -->
        <div *ngIf="verificationMessage" class="p-4 rounded-lg mb-4" [ngClass]="{
                'bg-blue-50 text-blue-700': verificationStatus === 'verifying',
                'bg-green-50 text-green-700': verificationStatus === 'success',
                'bg-red-50 text-red-700': verificationStatus === 'error'
            }">
            <div class="flex items-center gap-2">
                <svg *ngIf="verificationStatus === 'verifying'" class="animate-spin h-5 w-5"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                <svg *ngIf="verificationStatus === 'success'" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <svg *ngIf="verificationStatus === 'error'" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                <span>{{ verificationMessage }}</span>
            </div>
        </div>

        <!-- Submit Button -->
        <button type="button"
            class="w-full bg-easywills-black text-white px-4 py-3 rounded-lg font-semibold flex items-center justify-center gap-2"
            [ngClass]="{ 'opacity-50 cursor-not-allowed': isVerifying || !form.valid }" (click)="submit()">
            <svg *ngIf="isVerifying" class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <svg *ngIf="!isVerifying" width="19" height="18" viewBox="0 0 19 8" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M0.5 7H18.5M4.5 3V7H14.5V3C14.5 2.057 14.5 1.586 14.207 1.293C13.914 1 13.443 1 12.5 1H6.5C5.557 1 5.086 1 4.793 1.293C4.5 1.586 4.5 2.057 4.5 3Z"
                    stroke="#FDFDFD" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            {{ isVerifying ? 'Verifying...' : 'Verify' }}
        </button>
    </form>
</div>