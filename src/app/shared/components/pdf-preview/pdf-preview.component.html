<div
    (click)="onOverlayClick()"
    *ngIf="isOpen"
    aria-modal="true"
    class="fixed inset-0 z-50 flex items-center justify-center bg-opacity-50"
    role="dialog"
    tabindex="-1"
>
    <div
        (click)="$event.stopPropagation()"
        class="relative bg-white rounded-lg shadow-lg w-full max-w-3xl mx-4"
        tabindex="0"
    >
        <button
            (click)="close.emit()"
            aria-label="Close modal"
            class="close-button absolute text-gray-500 hover:text-gray-700 focus:outline-none"
            mat-icon-button
        >
            <mat-icon>close</mat-icon>
        </button>

        <!-- Expand icon in top-right corner -->
        <button (click)="openModal()" [disabled]="isLoading || !originalPdfData || pdfError" class="expand-button"
                mat-icon-button>
            <img alt="Expand PDF" class="expand-icon" src="svg/expandPdfIcon.svg">
        </button>

        <div class="p-6">
            <div *ngIf="isLoading" class="flex flex-col items-center justify-center">
                <mat-spinner diameter="40"></mat-spinner>
                <p class="mt-2">Loading will...</p>
            </div>

            <ng-container *ngIf="isBrowser && pdfSrc && !pdfError && !isLoading && isOpen">
                <pdf-viewer
                    (after-load-complete)="onPdfLoaded($event, 'main')"
                    (error)="onPdfError($event, 'main')"
                    [fit-to-page]="true"
                    [original-size]="false"
                    [page]="currentPage"
                    [render-text]="true"
                    [show-all]="false"
                    [src]="pdfSrc"
                    [zoom]="zoom"
                    style="display: block; height: 80vh;"
                ></pdf-viewer>
            </ng-container>

            <div *ngIf="(!isBrowser || pdfError || !pdfSrc) && !isLoading && isOpen" class="sample-will text-center">
                <div class="sample-will-content">
                    <h2 class="sample-will-title"></h2>
                    <h3 class="sample-will-name"></h3>
                    <p class="sample-will-text">{{ errorMessage }}</p>
                </div>
            </div>
        </div>

        <div
            *ngIf="!isLoading && isOpen && pdfSrc && !pdfError"
            class="flex items-center justify-center gap-4 py-4 border-t"
        >
            <button
                (click)="previousPage()"
                [disabled]="currentPage <= 1"
                aria-label="Previous page"
                class="prev"
                mat-icon-button
            >
                <mat-icon>arrow_back_ios</mat-icon>
            </button>
            <span class="page-indicator">Page {{ currentPage }} of {{ totalPages || '...' }}.</span>
            <button
                (click)="nextPage()"
                [disabled]="currentPage >= (totalPages || 1)"
                aria-label="Next page"
                class="next"
                mat-icon-button
            >
                <mat-icon>arrow_forward_ios</mat-icon>
            </button>
        </div>
    </div>
</div>

<!-- Modal Overlay -->
<div
    (click)="closeModal()"
    (keydown)="onOverlayKeydown($event)"
    *ngIf="isModalOpen"
    aria-label="Close modal"
    class="modal-overlay"
    role="button"
    tabindex="0">
    <!-- Close button (top right) -->
    <button (click)="closeModal()" class="modal-close-button-overlay" mat-icon-button>
        <mat-icon>close</mat-icon>
    </button>

    <!-- Side Navigation Arrows -->
    <button (click)="previousPage(); $event.stopPropagation()"
            [disabled]="currentPage <= 1"
            class="modal-nav-button-side prev"
            mat-icon-button>
        <mat-icon>arrow_back_ios</mat-icon>
    </button>
    <button (click)="nextPage(); $event.stopPropagation()"
            [disabled]="currentPage >= (totalPagesModal || 1)"
            class="modal-nav-button-side next"
            mat-icon-button>
        <mat-icon>arrow_forward_ios</mat-icon>
    </button>

    <!-- Main Modal Content -->
    <div (click)="$event.stopPropagation()"
         (keydown)="onModalKeydown($event)"
         aria-describedby="modal-description"
         aria-labelledby="modal-title"
         aria-modal="true"
         class="modal-container"
         role="dialog"
         tabindex="0">
        <div class="modal-pdf-container">
            <ng-container *ngIf="isBrowser && modalPdfSrc && !modalPdfError">
                <pdf-viewer
                    (after-load-complete)="onPdfLoaded($event, 'modal')"
                    (error)="onPdfError($event, 'modal')"
                    [original-size]="false"
                    [page]="currentPage"
                    [render-text]="true"
                    [show-all]="true"
                    [src]="modalPdfSrc"
                    [zoom]="modalZoom"
                    aria-label="PDF document viewer"
                    style="display: block; width: 100%; height: 100%;">
                </pdf-viewer>
            </ng-container>
            <div *ngIf="(!isBrowser || modalPdfError || !modalPdfSrc)" class="modal-sample-will">
                <div class="sample-will-content">
                    <h2 class="sample-will-title" id="modal-title">LAST WILL AND TESTAMENT OF</h2>
                    <h3 class="sample-will-name">Jane Doe</h3>
                    <p class="sample-will-text" id="modal-description">Could not load PDF in expanded view.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Page Indicator -->
    <div *ngIf="modalPdfSrc && !modalPdfError" class="modal-page-indicator-bottom">
        Page {{ currentPage }} of {{ totalPagesModal || '...' }}.
    </div>
</div>
